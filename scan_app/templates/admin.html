{% extends 'base.html' %}
{% block content %}
    <style>
      .loader{
        display:none;
      }
    </style>
    <div class="container-fluid" style="margin-top:20px;">
      <div class="row">
        <div class="col-lg-12">
          <div class="card border-secondary">
            <div class="card-body">
              <h4 class="card-title">CV Filter</h4>
              <hr/>
              <div class="row">
                <div class="col-lg-6">
                  <p class="card-text">Degrees</p>
                  <div class="card border-secondary">
                    <div class="card-body" style="height:300px;overflow:auto">
                      <table class="table">
                        <tr>
                          <th>Rank</th>
                          <th>Degree</th>
                        </tr>
                        {% for d in degree %}
                          <tr>
                            <td>{{d.degree_rank}}.</td>
                            <td><p style="margin-bottom:3px;cursor:pointer">{{d}}</p></td>
                          </tr>
                          {% endfor %}
                      </table>


                    </div>
                  </div>
            </div>
                <div class="col-lg-6">
                  <p class="card-text">University/College</p>
                  <div class="card border-secondary">
                    <div class="card-body"  style="height:300px;overflow:auto">
                      <table class="table">
                        <tr>
                          <th>Rank</th>
                          <th>Name of University/College</th>
                        </tr>
                        {% for d in college %}
                          <tr>
                            <td>{{d.clg_rank}}.</td>
                            <td><p style="margin-bottom:3px;cursor:pointer">{{d}}</p></td>
                          </tr>
                          {% endfor %}
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              <hr/>
              <div class="row">
                <div class="col-lg-12" style="margin-top:15px;">
                  <p id="key" class="card-text">Keywords</p>
                  <div class="card border-secondary">
                    <div class="card-body" id="keydata" style="height:150px;overflow:auto">
                        {% for k in keywords %}
                          <button class="btn btn-secondary" style="margin-bottom:3px;">{{k}}</button>
                        {% endfor %}
                          <a id="addkey" href="#key" style="margin-left:3px;">Add keyword</a
                          <div style="">
                            <input type="text" placeholder="enter keyword"
                            style="width:220px;padding:4px;display:none" id="newkey" />
                            <span id="closekey" style="margin-left:7px;cursor:pointer;display:none">X</span>
                          </div>
                    </div>
                  </div>
            </div>
              </div>

<!--
            <div class="row">
              <div class="col-lg-12">
                <div class="card border-secondary" style="margin-top:30px;">
                  <div class="card-body">
                    <p class="card-text">Other Requirements</p>
                    <textarea id="Requirements" class="form-control"></textarea>
                  </div>
                </div>
              </div>
            </div> -->
            <p class="text-center">
              <a href="#end" class="btn btn-primary" id="process" style="margin-top:15px;">Submit Now</a>
            </p>
          </div>
        </div>
          </div>
        </div>



        <div class="row">
          <div class="col-lg-12" style="margin-top:15px;">
            <div class="card border-secondary">
              <div class="card-body">
                <h4 class="card-title">Results <span class="text-warning" style="font-size:14px;">( Ranking 1 to 100 )</span></h4>
                <hr/>
                <div class="row">
                  <div class="col-lg-6 col-md-6">
                    <div class="card border-secondary ">
                      <div class="card-body">
                        <h4 class="card-title text-info">College Rank</h4>
                        <div>
                          <table class="table" id="college">
                          </table>
                          <div class="loader">
                            <div class='text-center'><img src="/static/css/loader-1.gif" style="width:100px" /></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-6 col-md-6">
                    <div class="card border-secondary ">
                      <div class="card-body">
                        <h4 class="card-title  text-info">Degree Rank</h4>
                        <div id="" class="table">
                          <table class="table" id="degree">
                          </table>
                          <div class="loader">
                            <div class='text-center'><img src="/static/css/loader-1.gif" style="width:100px" /></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-12">
                    <div class="card border-secondary ">
                      <div class="card-body">
                        <h4 class="card-title text-info">Keyword Rank</h4>
                        <div id="" class="table">
                          <table class="table" id="keyword">
                          </table>
                          <div class="loader">
                            <div class='text-center'><img src="/static/css/loader-1.gif" style="width:100px" /></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              </div>
            </div>
          </div>
      </div>
      <div id="end"></div>
{% endblock %}
{% block script %}
<script>
  $('#addkey').click(function(){
    $(this).hide();
    $('#newkey').show();
    $('#closekey').show();
  });

  $(document).on('click', '#closekey', function(){
    $(this).hide();
    $('#newkey').hide();
    $('#addkey').show();
  });

  $('#process').click(function(){
    $(this).hide();
    $('.loader').fadeIn();
    $.get('http://127.0.0.1:8000/adminpanel/api/v1/processcv', function(data){
      $('.loader').hide();
      $('#process').show();
      var obj = JSON.parse(data);
      console.log(obj);
      $("#college").empty();
      $("#degree").empty();
      $("#keyword").empty();
      for(i=0;i<obj.collegeRank.length;i++){
      	$.each( obj.collegeRank[i], function( key, value ) {
      		$("#college").append('<tr><td>'+key+"</td><td>"+value+"</td></tr>");
      	});
      }

      for(i=0;i<obj.degreeRank.length;i++){
      	$.each( obj.degreeRank[i], function( key, value ) {
          if(value!=""){
            $("#degree").append('<tr><td>'+key+"</td><td>"+value+"</td></tr>");
          }

      	});
      }

      for(i=0;i<obj.keywordRank.length;i++){
      	$.each( obj.keywordRank[i], function( key, value ) {
          if(key=='keywords'){
            $("#keyword").append('<tr><td>'+key+"</td><td>"+value+"</td></tr>");
          }else if(key=='keywordsCount'){
            $("#keyword").append('<tr><td>'+key+"</td><td>"+value+"</td></tr>");
          }else{
            $("#keyword").append('<tr><td>'+key+"</td><td>"+(value*100).toFixed(2)+"</td></tr>");
          }

      	});
      }
    });
  });
</script>
{% endblock %}
